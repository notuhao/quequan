<!--
  2025 ä½œè€…ï¼šæœ«ä¼ä¹‹å¤œã€‚
  åŸºäº MIT License å¼€æºã€‚
  è¯·åŠ¡å¿…ä»å¯é æ¥æºè®¿é—®æœ€æ–°ç‰ˆæœ¬ï¼š
  æ®‹å…½å‰è¿›åŸºåœ°ï¼ˆä¸‹ç­é­”åŒäººä¾§ï¼‰ ç¾¤å·ç ï¼š805836168
  é­”æ³•å›½åº¦å¨±ä¹ä¸­å¿ƒï¼ˆä¸‹ç­é­”æ¸¸æˆç¾¤ï¼‰ ç¾¤å·ç ï¼š109252951
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é›€æƒï¼šç¬¬äºŒå±Šç¿ é›€æ¯å¼€èµ›</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <!-- å†…è”æ ·å¼ -->
  <style>
    body { background: #f0f2f5; }
    .stat { width: 100px; }
    .progress-wrapper { position: relative; display: inline-block; }
    .arrow { position: absolute; top: -18px; right: -2px; font-size: 14px; visibility: hidden; }
    #game-card.swipeable:active { cursor: grabbing; }
    #game-card.swipeable.swipe-left { transform: translateX(-150%) rotate(-20deg); opacity: 0; }
    #game-card.swipeable.swipe-right { transform: translateX(150%) rotate(20deg); opacity: 0; }
    #stats .progress { background: #e9ecef; }
    #turn-count { text-align: center; margin-bottom: 1rem; }
    /* æ¸¸æˆç»“æŸè¦†ç›– */
    #game-over {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); color: #fff;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      font-size: 1.2rem; z-index: 1000;
    }
    #game-over button { margin-top: 1rem; }
    /* äº‹ä»¶æ–‡æœ¬ä¿ç•™æ¢è¡Œï¼Œå·¦å¯¹é½ */
    #event-text { white-space: pre-wrap; text-align: left; }
    /* é¡µè„šæ ·å¼ */
    footer { text-align: center; padding: 8px 0; color: #888; font-size: 0.85rem; }
  </style>
</head>
<body>
  <div class="container py-3">
    <!-- å›åˆæ•°ï¼šé¡µé¢æœ€ä¸Šæ–¹å±…ä¸­ -->
    <div id="turn-count" class="text-center">
      <small>å›åˆ</small>
      <div><span id="turn-number">0</span></div>
    </div>
    <!-- é¡¶éƒ¨ä¿¡æ¯ï¼šçŠ¶æ€æ  -->
    <div id="stats" class="d-flex justify-content-around align-items-center mb-4">
      <!-- å°ç’ -->
      <div class="stat text-center position-relative">
        <small>å°ç’</small>
        <div class="d-inline-block progress-wrapper">
          <div class="progress" style="width: 80px; height: 8px;">
            <div id="bar-attr1" class="progress-bar" role="progressbar"></div>
          </div>
          <span id="arrow-attr1" class="arrow"></span>
        </div>
      </div>
      <!-- å¤å‡‰ -->
      <div class="stat text-center position-relative">
        <small>å¤å‡‰</small>
        <div class="d-inline-block progress-wrapper">
          <div class="progress" style="width: 80px; height: 8px;">
            <div id="bar-attr2" class="progress-bar" role="progressbar"></div>
          </div>
          <span id="arrow-attr2" class="arrow"></span>
        </div>
      </div>
      <!-- å°ç™½ -->
      <div class="stat text-center position-relative">
        <small>å°ç™½</small>
        <div class="d-inline-block progress-wrapper">
          <div class="progress" style="width: 80px; height: 8px;">
            <div id="bar-attr3" class="progress-bar" role="progressbar"></div>
          </div>
          <span id="arrow-attr3" class="arrow"></span>
        </div>
      </div>
      <!-- è´£ä»» -->
      <div class="stat text-center position-relative">
        <small>è´£ä»»</small>
        <div class="d-inline-block progress-wrapper">
          <div class="progress" style="width: 80px; height: 8px;">
            <div id="bar-attr4" class="progress-bar" role="progressbar"></div>
          </div>
          <span id="arrow-attr4" class="arrow"></span>
        </div>
      </div>
    </div>
    <!-- å¡ç‰ŒåŒºåŸŸ -->
    <div class="d-flex justify-content-center align-items-center" style="height: 70vh;">
      <div id="game-card" class="card shadow-lg rounded-3 swipeable" style="width: 350px; cursor: grab; transition: transform 0.3s;">
        <div class="card-body d-flex align-items-center justify-content-start" style="height: 200px;">
          <p id="event-text" class="card-text">åŠ è½½ä¸­...</p>
        </div>
        <div class="card-footer d-flex justify-content-between">
          <button id="btn-left" class="btn btn-danger"><i class="fas fa-thumbs-down fa-lg"></i></button>
          <button id="btn-right" class="btn btn-success"><i class="fas fa-thumbs-up fa-lg"></i></button>
        </div>
      </div>
    </div>
  </div>
  <!-- é¡µè„šç‰ˆæƒå£°æ˜ -->
  <footer>
    2025 æœ«ä¼ä¹‹å¤œ<br>
    è¯·ä»å¯é æ¥æºè®¿é—®æœ€æ–°ç‰ˆæœ¬ï¼š<br><a href="https://github.com/notuhao/quequan-game" target="_blank">GitHub</a><br><a href="http://qm.qq.com/cgi-bin/qm/qr?_wv=1027&k=7SkPyirELH-LN52Tz8PHjl1TLqbHwhdh&authKey=fGUcO5nmulznuZrZUGGJ01CFS4phfoPdo%2B3QoppW5FwcsO%2BsuLHRcpTSdhqYVPrF&noverify=0&group_code=805836168" target="_blank">æ®‹å…½å‰è¿›åŸºåœ°ï¼ˆä¸‹ç­é­”åŒäººä¾§ï¼‰</a><br><a href="http://qm.qq.com/cgi-bin/qm/qr?_wv=1027&k=rU7wcxZXUtC-U1nafP29Cgv5CfFWlAHl&authKey=%2BrMuEaGIlWVNL7ZKvs1ZoZBWUsUk9X7MEmDMeG1Xy5t86nekeIENl%2BLFytjC4zzg&noverify=0&group_code=109252951" target="_blank">é­”æ³•å›½åº¦å¨±ä¹ä¸­å¿ƒï¼ˆä¸‹ç­é­”æ¸¸æˆç¾¤ï¼‰</a>
  </footer>
  <!-- å†…åµŒäº‹ä»¶æ•°æ® -->
  <script id="events-data" type="application/json">
[
  {
    "id": "e001",
    "initial": true,
    "weight": 1,
    "text": "é¢å¯¹å°ç’å’Œå°ç™½ä¸€èµ·å–Šâ€œå¦ˆå¦ˆâ€çš„æƒ…æ™¯ï¼Œä½ çš„é€‰æ‹©æ˜¯ï¼Ÿ",
    "accept": { "attr1": 25, "attr2": -5, "attr3": 20, "attr4": 20 },
    "reject": { "attr1": -5, "attr2": 10, "attr3": -10, "attr4": 0 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "e002",
    "initial": true,
    "weight": 1,
    "text": "å°ç’åœ¨æˆ˜æ–—åæƒ…ç»ªå´©æºƒï¼Œæå‡ºæƒ³æš‚æ—¶ä¸å‚åŠ å·¡é€»ï¼Œå¸Œæœ›ä½ æ›¿å¥¹å€¼ç­ï¼Œè®©å¥¹ä¼‘æ¯ä¸€å¤©ã€‚",
    "accept": { "attr1": 30, "attr2": -5, "attr3": 5, "attr4": -20 },
    "reject": { "attr1": -20, "attr2": 0, "attr3": 0, "attr4": 20 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "e003",
    "initial": true,
    "weight": 1,
    "text": "å¤å‡‰å‘ç°ä¸€ä¸ªå¯ç–‘é­”åŠ›æ³¢åŠ¨è¯·æ±‚ç´§æ€¥æ”¯æ´ï¼Œä½†è¿™æ„å‘³ç€ä½ å¿…é¡»æ”¾å¼ƒå’Œå°ç™½çº¦å¥½çš„å…±åŒå·¡é€»è®¡åˆ’ã€‚",
    "accept": { "attr1": -5, "attr2": 25, "attr3": -10, "attr4": 15 },
    "reject": { "attr1": 5, "attr2": -20, "attr3": -5, "attr4": -15 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "e004",
    "initial": true,
    "weight": 1,
    "text": "å°ç™½æ·±å¤œæ•²ä½ æˆ¿é—¨ï¼Œè¯´å¥¹åšäº†å™©æ¢¦ï¼Œæƒ³é åœ¨ä½ è‚©ä¸Šåä¸€ä¼šå„¿ã€‚",
    "accept": { "attr1": 5, "attr2": -5, "attr3": 30, "attr4": -10 },
    "reject": { "attr1": -10, "attr2": 0, "attr3": -20, "attr4": 10 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "e005",
    "initial": true,
    "weight": 1,
    "text": "ä¸‰äººåµæ¶åå°ç’ä¸€ä¸ªäººååœ¨è®­ç»ƒåœºï¼Œä½ è¦å»å®‰æ…°å¥¹å—ï¼Ÿä½†æ˜¯ä½ ä¹‹å‰çº¦å¥½äº†è¦ä¸ºå¤å‡‰è®²è§£ä¸‹ä¸€æ­¥çš„è®­ç»ƒã€‚",
    "accept": { "attr1": 25, "attr2": -10, "attr3": -5, "attr4": -15 },
    "reject": { "attr1": -15, "attr2": 10, "attr3": 5, "attr4": 20 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "e006",
    "initial": true,
    "weight": 1,
    "text": "å°ç’ç”Ÿæ—¥ï¼Œå¥¹å¸Œæœ›ä½ èŠ±ä¸€å¤©æ—¶é—´å’Œå¥¹ä¸€èµ·è¿‡ï¼Œä½†å½“å¤©ä½ è´Ÿè´£çš„å·¡é€»åŒºå¾ˆæœ‰å¯èƒ½å‡ºç°æ®‹å…½ã€‚",
    "accept": { "attr1": 30, "attr2": -5, "attr3": 0, "attr4": -40 },
    "reject": { "attr1": -10, "attr2": 5, "attr3": 5, "attr4": 25 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "e007",
    "initial": true,
    "weight": 1,
    "text": "ä½ éœ€è¦å•ç‹¬æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œä½†å°ç’æ‹…å¿ƒä½ å®‰å±ï¼Œè¯·æ±‚é™ªåŒå‰å¾€ã€‚ä¸è¿‡ä½ çŸ¥é“è¿™æ ·ä¼šè®©å°ç’é™·å…¥å±é™©ä¹‹ä¸­ã€‚",
    "accept": { "attr1": 20, "attr2": 0, "attr3": 5, "attr4": -25 },
    "reject": { "attr1": -10, "attr2": 5, "attr3": -5, "attr4": 20 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "e008",
    "initial": true,
    "weight": 1,
    "text": "å¤å‡‰å·å·å‘Šè¯‰ä½ ï¼Œå¥¹è§‰å¾—è‡ªå·±è¢«å¿½è§†äº†ï¼Œå¸Œæœ›ä½ è¿™å‘¨å¤šå’Œå¥¹ä¸€èµ·è®­ç»ƒã€‚",
    "accept": { "attr1": -5, "attr2": 25, "attr3": -5, "attr4": -10 },
    "reject": { "attr1": 10, "attr2": -10, "attr3": 5, "attr4": 15 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },

  {
    "id": "bct1",
    "initial": true,
    "weight": 10,
    "chain": true,
    "oneTime": true,
    "text": "å°ç™½ç»å†äº†æ•°æ¬¡æˆ˜æ–—åæ€§æ ¼å˜å¾—å†·æ¼ ã€‚æ·±å¤œï¼Œå¥¹ç«™åœ¨ä½ çš„æˆ¿é—¨å£æ²‰é»˜åœ°çœ‹ç€ä½ å‡ ç§’ï¼Œåˆè½¬èº«ç¦»å¼€ã€‚ä½ æ˜¯å¦ä¸»åŠ¨å«ä½å¥¹ï¼Œä¸å¥¹é•¿è°ˆï¼Ÿ",
    "accept": { "attr1": 5, "attr2": -5, "attr3": 25, "attr4": -10 },
    "reject": { "attr1": -5, "attr2": 10, "attr3": -20, "attr4": 15 },
    "acceptUnlock": ["bct3"],
    "rejectUnlock": ["bct2"]
  },
  {
    "id": "bct2",
    "initial": false,
    "weight": 1,
    "chain": true,
    "oneTime": true,
    "text": "ä½ æ²¡æœ‰å«ä½å°ç™½ï¼Œåªæ˜¯çœ‹ç€å¥¹ç¦»å¼€ã€‚ç¬¬äºŒå¤©ï¼Œå¥¹åœ¨æˆ˜æ–—ä¸­æ¯«ä¸é¡¾åŠè‡ªå·±çš„ä¼¤åŠ¿ï¼Œç–¯ç‹‚æ”»å‡»æ•Œäººã€‚å¤å‡‰è¯´å¥¹åƒæ˜¯æƒ³è¢«æ‰“æ­»â€¦â€¦ä½ æ˜¯å¦å†³å®šç§ä¸‹é™åˆ¶å¥¹å‚æˆ˜ï¼Ÿ",
    "accept": { "attr1": -10, "attr2": 10, "attr3": -20, "attr4": 20 },
    "reject": { "attr1": 0, "attr2": -5, "attr3": 5, "attr4": -15 },
    "acceptUnlock": ["bct4"],
    "rejectUnlock": ["bct5"]
  },
  {
    "id": "bct3",
    "initial": false,
    "weight": 1,
    "chain": true,
    "oneTime": true,
    "text": "ä½ å«ä½äº†å°ç™½ï¼Œåœ¨é•¿è°ˆä¸­å¥¹æ²®ä¸§åœ°è¯´ï¼šâ€œâ€¦â€¦æ¯•ç«Ÿä½ æœ€åœ¨ä¹çš„æ˜¯å°ç’å’Œå¤å‡‰ï¼Œä¸æ˜¯æˆ‘ã€‚â€ä½ è¯¥æ€ä¹ˆå›åº”ï¼Ÿæ˜¯å¦ç™½å¥¹è¯¯ä¼šäº†ä½ ï¼Œè¿˜æ˜¯é€‰æ‹©è½¬ç§»è¯é¢˜ï¼Ÿ",
    "accept": { "attr1": 10, "attr2": 0, "attr3": 15, "attr4": -5 },
    "reject": { "attr1": -5, "attr2": 5, "attr3": -10, "attr4": 10 },
    "acceptUnlock": ["bct6"],
    "rejectUnlock": ["bct7"]
  },
  {
    "id": "bct4",
    "initial": false,
    "weight": 1,
    "chain": true,
    "oneTime": true,
    "text": "ä½ å†³å®šç§ä¸‹é™åˆ¶å°ç™½å‚æˆ˜ï¼Œä½†å¥¹å¾—çŸ¥åä¾æ—§æ“…è‡ªå•ç‹¬è¡ŒåŠ¨å¯¼è‡´å—é‡ä¼¤ï¼Œé‡ä¼¤åä¾ç„¶ä¸æ„¿è¢«é€å›åŸºåœ°ã€‚ä½ æ˜¯å¦å¼ºåˆ¶ä¸‹ä»¤å¥¹ä¼‘å…»ï¼Ÿ",
    "accept": { "attr1": -20, "attr2": 0, "attr3": -30, "attr4": 25 },
    "reject": { "attr1": 5, "attr2": 10, "attr3": 5, "attr4": 15 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "bct5",
    "initial": false,
    "weight": 1,
    "chain": true,
    "oneTime": true,
    "text": "ä½ å†³å®šä¸å¹²é¢„å°ç™½çš„è¡Œä¸ºï¼Œåªæ˜¯é»˜é»˜åœ°åœ¨æˆ˜æ–—ä¸­æ›¿å¥¹æŒ¡ä¸‹è‡´å‘½æ”»å‡»ã€‚è¿™è¢«å¥¹çœ‹åˆ°åï¼Œå¥¹è¡¨é¢å†·æ¼ ï¼Œå´æ‚„æ‚„éœ²å‡ºäº†éš¾è¿‡çš„ç¥æƒ…ã€‚",
    "accept": { "attr1": 5, "attr2": 0, "attr3": 10, "attr4": -5 },
    "reject": { "attr1": 0, "attr2": 0, "attr3": 0, "attr4": 5 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "bct6",
    "initial": false,
    "weight": 1,
    "chain": true,
    "oneTime": true,
    "text": "ä½ è®¤çœŸå‘Šè¯‰å¥¹ï¼Œä½ å¹¶æ²¡æœ‰æœ€åœ¨ä¹è°ï¼Œè€Œæ˜¯æ¯ä¸ªäººä½ éƒ½åœ¨ä¹ã€‚å¥¹æ²‰é»˜äº†å¾ˆä¹…ï¼Œè¯´å¥¹ä¼šå°è¯•â€œç›¸ä¿¡ä½ ä¸€æ¬¡â€ã€‚",
    "accept": { "attr1": 15, "attr2": 0, "attr3": 25, "attr4": -5 },
    "reject": { "attr1": 0, "attr2": 0, "attr3": -5, "attr4": 5 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "bct7",
    "initial": false,
    "weight": 1,
    "chain": true,
    "oneTime": true,
    "text": "ä½ å«ç³Šå…¶è¾ï¼Œè¯´ä»¥åæœ‰æ—¶é—´å†è°ˆï¼Œå°ç™½éœ²å‡ºå¤±æœ›çš„ç¥æƒ…ï¼Œç‚¹ç‚¹å¤´ç¦»å¼€äº†ã€‚ä½ æ˜¯å¦ä¸»åŠ¨åˆ¶é€ å¦ä¸€ä¸ªç‹¬å¤„æœºä¼šï¼Ÿ",
    "accept": { "attr1": 0, "attr2": 0, "attr3": -10, "attr4": 0 },
    "reject": { "attr1": 5, "attr2": -5, "attr3": 5, "attr4": 5 },
    "acceptUnlock": [],
    "rejectUnlock": []
  },

  {
    "id": "end-attr1Low",
    "initial": false,
    "ending": true,
    "weight": 1,
    "text": "ã€å—ä¼¤çš„å°ç’ã€‘\nè¢«ä½ å¿½è§†çš„å°ç’æœ€è¿‘ä¸€ç›´æ˜¾å¾—å¿ƒäº‹é‡é‡ï¼Œæœ€ç»ˆå¯¼è‡´äº†è¡ŒåŠ¨å¤±è¯¯ï¼Œåœ¨æˆ˜æ–—ä¸­è´Ÿä¼¤ã€‚",
    "accept": {},
    "reject": {},
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "end-attr1High",
    "initial": false,
    "ending": true,
    "weight": 1,
    "text": "ã€è¢«å°ç’æ¨å€’ã€‘\nåœ¨å¯¹å°ç’è¿‡åº¦æººçˆ±çš„èƒŒåï¼Œä½ æ¸æ¸å¤±å»äº†ç‹¬ç«‹åº”å¯¹ä¸¤äººå…³ç³»çš„èƒ½åŠ›ã€‚æœ€ç»ˆä½ è¢«å°ç’æ¨å€’äº†ã€‚",
    "accept": {},
    "reject": {},
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "end-attr2Low",
    "initial": false,
    "ending": true,
    "weight": 1,
    "text": "ã€è¿™å¤å‡‰äº†ã€‘\nå¤å‡‰çš„å†…å¿ƒè¢«ä½ çš„ç–å¿½åˆºç—›ï¼Œå¥¹å†³å®šç¦»å¼€é˜Ÿä¼ï¼Œå¯»æ±‚æ–°çš„å¼€å§‹ã€‚",
    "accept": {},
    "reject": {},
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "end-attr2High",
    "initial": false,
    "ending": true,
    "weight": 1,
    "text": "ã€å‘é„™çš„å¤å‡‰ã€‘\nå¤å‡‰åœ¨è¢«ä½ çºµå®¹åï¼Œé‡å¿ƒè†¨èƒ€ï¼Œå¾—å¯¸è¿›å°ºã€‚æœ€ç»ˆä½ ä»¬çš„å…³ç³»å½»åº•å´©å¡Œã€‚",
    "accept": {},
    "reject": {},
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "end-attr3Low",
    "initial": false,
    "ending": true,
    "weight": 1,
    "text": "ã€åä¸ºç™½é™è±çš„ç©ºå£³ã€‘\nå°ç™½çš„ä¿¡ä»»ä¹‹å¼¦å½»åº•æ–­è£‚ï¼Œå¥¹å†ä¹Ÿæ— æ³•ä¸ä½ å…±é¸£ã€‚ä½ çœ¼å‰çš„â€œç™½é™è±â€åªå‰©ä¸‹ç©ºå£³ã€‚",
    "accept": {},
    "reject": {},
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "end-attr3High",
    "initial": false,
    "ending": true,
    "weight": 1,
    "text": "ã€è–„é›ªè½»æ‰¬ã€‘\nåœ¨ä½ æ— å¾®ä¸è‡³çš„å…³æ€€ä¸‹ï¼Œå°ç™½çš„å­å¿ƒæ¸æ¸å˜è´¨äº†â€¦â€¦",
    "accept": {},
    "reject": {},
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "end-attr4Low",
    "initial": false,
    "ending": true,
    "weight": 1,
    "text": "ã€é­”æ³•å°‘å¥³å¤±æ ¼ã€‘\nä½ çš„å¤±èŒå¯¼è‡´äº†ä½ éš¾ä»¥æ¥å—çš„ä¸å¹¸â€¦â€¦",
    "accept": {},
    "reject": {},
    "acceptUnlock": [],
    "rejectUnlock": []
  },
  {
    "id": "end-attr4High",
    "initial": false,
    "ending": true,
    "weight": 1,
    "text": "ã€è£å‡å®çŸ³æƒæ–ã€‘\nä½ æ´»è·ƒè¡¨ç°å¼•èµ·äº†é­”æ³•å›½åº¦çš„æ³¨æ„ï¼Œä½ è¢«è¿«æˆä¸ºäº†å°Šè´µçš„å®çŸ³æƒæ–ã€‚ä½†ä»£ä»·æ˜¯ï¼Œä½ å†ä¹Ÿæ— æ³•å›åˆ°æ›¾ç»çš„å¹³å‡¡ã€‚",
    "accept": {},
    "reject": {},
    "acceptUnlock": [],
    "rejectUnlock": []
  }
]
  </script>
  <!-- åº“æ–‡ä»¶ -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <!-- å†…è”è„šæœ¬ -->
  <script>
  $(function() {
    let turnCount = 0;
    let stats = { attr1:50, attr2:50, attr3:50, attr4:50 };
    let rawEvents = JSON.parse($('#events-data').html());
    let lastCause = '';     // ç”¨äºè®°å½•è§¦å‘çš„ç»“å±€ç±»å‹
    let recentEvents = [];   // ä¿å­˜æœ€è¿‘ä¸¤æ¬¡å±•ç¤ºçš„äº‹ä»¶ ID

    // 1. ç»™æ¯ä¸ªäº‹ä»¶è¡¥å…¨é»˜è®¤å­—æ®µ
    let allEvents = rawEvents.map(e => {
      return {
        // é»˜è®¤å€¼
        weight: 1,
        oneTime: false,
        chain: false,
        ending: false,
        acceptUnlock: [],
        rejectUnlock: [],
        initial: false,
        // å†è¦†ç›–åŸå§‹å­—æ®µ
        ...e,
        // æœ€åä¿éšœ acceptUnlock/rejectUnlock è‡³å°‘æ˜¯æ•°ç»„
        acceptUnlock: Array.isArray(e.acceptUnlock) ? e.acceptUnlock : [],
        rejectUnlock: Array.isArray(e.rejectUnlock) ? e.rejectUnlock : []
      };
    });

    // 2. äº‹ä»¶æ˜ å°„ã€æ¬¡æ•°ç»Ÿè®¡ã€è§£é”åˆ—è¡¨
    let eventMap = {}, countMap = {}, unlocked = [], endingMode = false, chainNext = null;
    allEvents.forEach(e => {
      // å¦‚æœ weight éæ³•ï¼ˆéæ•°å­—æˆ– <=0ï¼‰ï¼Œå¼ºåˆ¶ä¸º 1
      if (typeof e.weight !== 'number' || e.weight <= 0) e.weight = 1;
      eventMap[e.id] = e;
      countMap[e.id] = 0;
      if (e.initial) unlocked.push(e.id);
    });

    let available = unlocked.slice(), currentEvent = null, gameOver = false;

    // æ¸¸æˆç»“å±€æ ‡é¢˜ï¼ˆåŸå› ï¼‰
    const msgMap = {
      attr1Low: 'å—ä¼¤çš„å°ç’', attr1High: 'è¢«å°ç’æ¨å€’',
      attr2Low: 'è¿™å¤å‡‰äº†',   attr2High: 'å‘é„™çš„å¤å‡‰',
      attr3Low: 'åä¸ºç™½é™è±çš„ç©ºå£³', attr3High: 'è–„é›ªè½»æ‰¬',
      attr4Low: 'é­”æ³•å°‘å¥³å¤±æ ¼', attr4High: 'è£å‡å®çŸ³æƒæ–'
    };

    function renderStats() {
      $('#bar-attr1').css('width', stats.attr1 + '%');
      $('#bar-attr2').css('width', stats.attr2 + '%');
      $('#bar-attr3').css('width', stats.attr3 + '%');
      $('#bar-attr4').css('width', stats.attr4 + '%');
      $('#turn-number').text(turnCount);
    }

    // åŠ æƒéšæœºæŠ½å–ï¼ˆä½¿ç”¨äº†æ­£è§„åŒ–åçš„ weightï¼‰
    function weightedPick(ids) {
      let total = ids.reduce((sum, id) => sum + eventMap[id].weight, 0);
      let r = Math.random() * total, acc = 0;
      for (let id of ids) {
        acc += eventMap[id].weight;
        if (r <= acc) return id;
      }
      return ids[0];
    }

    // è¿›å…¥ä¸‹ä¸€äº‹ä»¶
    function nextEvent() {
      if (gameOver) return;
      let pool;
      if (endingMode) return;   // å¤„äºç»“å±€äº‹ä»¶æ—¶ä¸å†æŠ½å–æ–°äº‹ä»¶ï¼ˆå¦‚æœè¦æŠŠç»“å±€äº‹ä»¶åšæˆå¤šä¸ªäº‹ä»¶åˆ™å¯èƒ½è¦æ³¨é‡Šæ‰è¿™æ®µï¼‰
      if (chainNext) {
        pool = chainNext;       // è¿é”è§£é”åˆ—è¡¨
        chainNext = null;
      } else {
        // ä» unlocked ä¸­å‰”é™¤ä¸€æ¬¡æ€§å·²ç”¨äº‹ä»¶
        let avail = unlocked.filter(id => !(eventMap[id].oneTime && countMap[id] > 0));
        // æ’é™¤ç»“å±€äº‹ä»¶
        pool = avail.filter(id => !eventMap[id].ending);
      }
      if (!pool.length) {
        // å¾ªç¯ä½¿ç”¨è§£é”åˆ—è¡¨ä¸­å‡ºç°æœ€å°‘çš„
        let minC = Math.min(...unlocked.map(id => countMap[id]));
        pool = unlocked.filter(id => countMap[id] === minC && !eventMap[id].ending);
      }
      // å°è¯•å‰”é™¤æœ€è¿‘å‡ºç°çš„äº‹ä»¶
      let filtered = pool.filter(id => !recentEvents.includes(id));
      if (filtered.length > 0) {
        pool = filtered;
      }
      // æŒ‰æƒé‡æŠ½å–äº‹ä»¶
      let id = weightedPick(pool);
      // æŠŠæ–°æŠ½å–çš„äº‹ä»¶è®°å½•åˆ° recentEventsï¼ˆåªä¿ç•™æœ€åä¸¤æ¡ï¼‰
      recentEvents.push(id);
      if (recentEvents.length > 2) recentEvents.shift();
      // æ¸²æŸ“
      currentEvent = eventMap[id];
      $('#event-text').html(currentEvent.text);
      clearArrows();
    }

    // å¯åŠ¨ç»“å±€äº‹ä»¶
    function startEndingEvent(cause) {
      lastCause = cause;             // ä¿å­˜æ˜¯å“ªç§ç»“å±€
      let eid = 'end-' + cause;
      if (!eventMap[eid]) {
        showSettlement(cause);
      } else {
        endingMode = true;
        currentEvent = eventMap[eid];
        $('#event-text').html(currentEvent.text);
        clearArrows();
      }
    }

    // æ£€æŸ¥æ¸¸æˆç»“æŸ
    function checkGameOver() {
      for (let k in stats) {
        if (stats[k] <= 0) { startEndingEvent(k + 'Low'); return true; }
        if (stats[k] >= 100) { startEndingEvent(k + 'High'); return true; }
      }
      return false;
    }

    // æ­£å¼å±•ç¤ºç»“ç®—å¹¶æ·»åŠ åˆ†äº«æŒ‰é’®
    function showSettlement(cause) {
      gameOver = true;
      let title = msgMap[cause] || 'æœªçŸ¥åŸå› ';
      let shareText = `å­©å­ä»¬ï¼Œæˆ‘æ˜¯ä¿å§†æƒæ–çŸ¢è½¦èŠï¼Œæˆ‘åœ¨é›€æƒä¸­æ‰“å‡ºäº†ç»“å±€ã€${title}ã€‘\nå›åˆæ•°ï¼š${turnCount}\nå°ç’ï¼š${stats.attr1}  å¤å‡‰ï¼š${stats.attr2}  å°ç™½ï¼š${stats.attr3}  è´£ä»»ï¼š${stats.attr4}\nğŸ‘‰ å¿«æ¥æŒ‘æˆ˜ï¼šhttps://notuhao.github.io/quequan-game/`;
      $('body').append(`
        <div id="game-over">
          <h2>æ¸¸æˆç»“æŸï¼š${title}</h2>
          <p>å›åˆæ•°ï¼š${turnCount}</p>
          <p>ã€æœ€ç»ˆç»Ÿè®¡ã€‘</p>
          <p>æ—å°ç’äº²å¯†åº¦ï¼š${stats.attr1}</p>
          <p>å¤å‡‰äº²å¯†åº¦ï¼š${stats.attr2}</p>
          <p>ç™½é™è±äº²å¯†åº¦ï¼š${stats.attr3}</p>
          <p>èº«ä¸ºé­”æ³•å°‘å¥³çš„è´£ä»»ï¼š${stats.attr4}</p>
          <button id="btn-share" class="btn btn-light">åˆ†äº«æœ¬å±€</button>
          <small id="share-tip" style="display:none; margin-top:5px;">å†…å®¹å·²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿</small><br>
          <button id="btn-restart" class="btn btn-light mt-3">é‡æ–°å¼€å§‹</button>
        </div>
      `);
      $('#btn-share').on('click', () => {
        navigator.clipboard.writeText(shareText).then(() => {
          $('#share-tip').show();
        });
      });
      $('#btn-restart').on('click', () => location.reload());
    }

    // åº”ç”¨ç”¨æˆ·å†³ç­–
    function applyDecision(dec) {
      if (gameOver) return;
      // å¦‚æœå½“å‰æ˜¯â€œç»“å±€äº‹ä»¶â€ï¼Œç›´æ¥è¿›å…¥ç»“ç®—
      if (endingMode && currentEvent.ending) {
        showSettlement(lastCause);
        return;
      }
      turnCount++;
      let d = currentEvent[dec];
      // ä¿®æ”¹å±æ€§
      for (let k in d) stats[k] = Math.min(100, Math.max(0, stats[k] + d[k]));
      renderStats();
      // æ ‡è®°ä¸€æ¬¡æ€§äº‹ä»¶å·²ç”¨
      if (currentEvent.oneTime) countMap[currentEvent.id]++;
      else countMap[currentEvent.id]++;
      // è§£é”åç»­è¿é”äº‹ä»¶
      let nextIds = currentEvent[dec + 'Unlock'];
      if (currentEvent.chain && nextIds.length) {
        chainNext = nextIds.slice();
        nextIds.forEach(id => { if (!unlocked.includes(id)) unlocked.push(id); });
      }
      // æ£€æŸ¥æ¸¸æˆç»“æŸ
      if (!checkGameOver()) nextEvent();
    }

    // ç®­å¤´æç¤º
    function getArrow(v) {
      if (v <= -10) return 'â†“â†“';
      if (v < 0)    return 'â†“';
      if (v = 0)    return '';
      if (v < 10)   return 'â†‘';
      return 'â†‘â†‘';
    }
    function showArrows(dec) {
      let d = currentEvent[dec] || {};
      ['attr1','attr2','attr3','attr4'].forEach(s => {
        let delta = d[s] || 0;
        let el = $(`#arrow-${s}`);
        if (delta !== 0) {
          el.text(getArrow(delta)).css('visibility','visible');
        } else {
          el.css('visibility','hidden');
        }
      });
    }
    function clearArrows() {
      $('.arrow').css('visibility','hidden');
    }

    // ç»‘å®šæŒ‰é’®ä¸æ‰‹åŠ¿
    $('#btn-left').on('click', () => applyDecision('reject'))
                   .hover(() => showArrows('reject'), clearArrows);
    $('#btn-right').on('click', () => applyDecision('accept'))
                    .hover(() => showArrows('accept'), clearArrows);
    const mc = new Hammer(document.getElementById('game-card'));
    mc.on('swipeleft',  () => $('#game-card').addClass('swipe-left')
                        .delay(300).queue(next => { applyDecision('reject'); $('#game-card').removeClass('swipe-left'); next(); }));
    mc.on('swiperight', () => $('#game-card').addClass('swipe-right')
                        .delay(300).queue(next => { applyDecision('accept'); $('#game-card').removeClass('swipe-right'); next(); }));

    // å¯åŠ¨æ¸¸æˆ
    renderStats();
    nextEvent();
  });
  </script>
</body>
</html>
